---
show: step
version: 1.0
enable_checker: true
---

# Basic for Markdown Parser

## 1. Introduction

Markdown has became the standard way of writing documentation within programmer community. Its succinct syntax can help us to understanding the lexical analysis of compiler. In this project, we will implement a Markdown parser by using C++, and generate the content into HTML eventually.

#### Things to Learn

- lexical analysis
- syntax tree
- DFS: Deep First Search
- C++11
- C pointer for char stream processing

#### Final Results

The following figure illustrates the final output of our markdown parser:


![image desc](https://labex.io/upload/J/Q/V/D3yhhIZBEL4x.png)


Our final project folder will be as follows:

```
MarkdownParser
├── main.cpp
├── mdtransform.hpp
├── output
│   └── github-markdown.css
└── test.md
```

## 2. Markdown Syntax

The syntax of Markdown is relatively simple, here are some common syntax:

```markdown

# This is H1

## This is H2

## This is H3

## Emphasis

- **Bold**
- _italic_

## Reference

> quote reference

## Lists

- unordered list 1
- unordered list 2

1. ordered list 1
2. ordered list 2

## Code

inline code insert `printf('\n');`

## Link

This is a inline [link](https://github.com)

## Figure

![A figure](https://labex.io/upload/Q/K/E/NWVO8PPHyNj1.png)
```

As we can see from above, the syntax of markdown isn't that much complicated, and most of its syntax are based on the head of a line. This offers us that we can quickly build a simple markdown parser, and the only difficulties are just links, figures, codes, bold italic and etc.

## 3. Test Driven

In order to focus more on writing the Markdown parser itself, we will write the test files first. Thus, You can input:

```bash
wget https://labexfile.oss-us-west-1-internal.aliyuncs.com/courses/48/github-markdown.css
wget https://labexfile.oss-us-west-1-internal.aliyuncs.com/courses/48/test.md
```

in your bash for retrieve markdown testing file.

Secondly, in order to test the results of Markdown parser, we can considering convert `.md` file to HTML for display, we have prepared the css here, and you can directly copy it:

```markdown
# Markdown

## Overview

**Markdown** is created by [Daring Fireball](http://daringfireball.net/), the original guideline is [here](http://daringfireball.net/projects/markdown/syntax). Its syntax, however, varies between different parsers or editors.

## Syntax

[Official syntax](http://daringfireball.net/projects/markdown/syntax)

## Examples

---

# This is an H1

## This is an H2

###### This is an H6

- **Bold font**

- _italic_

## Block Reference

> This is a blockquote with two paragraphs. This is first paragraph.
>
> This is second pragraph.Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.


## un-ordered list
*   Red
*   Green
*   Blue

## ordered list
1.  Red
2. 	Green
3.	Blue


## Code

Inline code `printf('\n');`

## Link

Inline link: [GitHub](https://github.com/)

## Figure

![labex logo](https://static.labex.io/img/logo_03.png)
```

Finally, we write the main function of our markdown parser for testing.

Create and save `main.cpp` in `/home/labex/Code/`, and write the following code.

```cpp
//
//  main.cpp
//  MarkdownParser
//

#include <fstream>          // std::ofstream
#include "mdtransform.hpp"  // Markdown parser class

int main() {
    // construct markdown parser object
    MarkdownTransform transformer("test.md");
    
    // getTableOfContents will be used retrieve TOC of markdown file
    std::string table = transformer.getTableOfContents();
    
    // fetch HTML content of Markdown file
    std::string contents = transformer.getContents();
    
    // head information of HTML file
    std::string head = "<!DOCTYPE html><html><head>\
        <meta charset=\"utf-8\">\
        <title>Markdown</title>\
        <link rel=\"stylesheet\" href=\"github.markdown.css\">\
        </head><body><article class=\"markdown-body\">";
    std::string end = "</article></body></html>";
    
    // write to file
    std::ofstream out;
    out.open("output/index.html");
    // put HTML contents inside of <article></article>
    out << head+table+contents+end;
    out.close();
    return 0;
}
```

```checker
- name: check if file exist
  script: |
    #!/bin/bash
    ls /home/labex/Code/main.cpp
  error: Oops! We find that you didn't create file "main.cpp" in /home/labex/Code!
  timeout: 3
```

You should also create a folder `output` in `/home/labex/Code/`.

## 4. Designing mdtransform.hpp

We must define the relevant lexical/syntax rules in the program before parse then entire markdown document. Tt pave the way for subsequent conversion work.

If you understand the principle of compiler before this experiment, you can immediately understand the markdown parser. In reality, the principles are the compilation process of lexical analysis and parsing stage. For the final conversion to HTML, it is as same as the stage of "target code generation".

Fortunately, markdown syntax are simplistic that all syntax doesn't need any processing of semantic analysis, code optimization and more. Building the entire Markdown parser becomes briefness.

First, let's begin with lexical analysis. We need to designing the plan which is relevant  to lexemes implementation. Namely, designing key Tokens.

1. `#` is the landmark keword in markdown syntax, the number of `#` determines the type of title, directly using `<h>` tag of HTML;

2. normal paragraphs, directly using `p` to wrap;

3. the syntax of `[]()`, `![]()` enables us to insert hyperlinks and figures, we can using `<a href=" ">...</a>` and `<img alt="" src="" />`;

4. two \` can be encapsulate to a inline code, and then three \` can be encapsulate two a code block, we can use `code` and `<pre><code>` with respectively;

5. the keyword `>` is used for processing quote references, we can use `<blockquote>` for sure;

6. patterns of `-`, `1.` represents order list, we can use `<ul>` and `<ol>` for each one of them and finally use `<li>` to wrap them all;

7. in the end, `-` and `*` are for bold font and emphasis, `<em>` and `<strong>` can be used for them.

Now, the above seven points is enough to cover the most commonly used Markdown grammar, we will parse these part of the markdown file content, the definition of Token is as follows:

```
* 0: null                          |start
* 1: <p>                           |paragraph
* 2: <a href=" ">...</a>           |hyper link
* 3: <ul>                          |unordered list
* 4: <ol>                          |ordered list
* 5: <li>                          |list
* 6: <em>                          |emphasis
* 7: <strong>                      |bold
* 8: <hr />                        |horizontaly
* 9: <br />                        |new line
* 10: <img alt="" src="" />        |figure
* 11: <blockquote>                 |rederence
* 12: <h1>                         |h1
* 13: <h2>                         |h2
* 14: <h3>                         |h3
* 15: <h4>                         |h4
* 16: <h5>                         |h5
* 17: <h6>                         |h6
* 18: <pre><code>                  |code block
* 19: <code>                       |inline code
```

At the end of this document, we give the design of `MarkdownTransform` class.

Create and save `mdtransform.hpp` in `/home/labex/Code/`, and write the following code.

```cpp
#ifndef MD2HTML
#define MD2HTML

#include <cstdlib>
#include <fstream>
#include <vector>
#include <cstring>
#include <utility>
#include <string>
#include <cctype>
#include <cstdio>
using namespace std;

#define maxLength 10000

// enum of syntax keywords
enum{
    nul             = 0,
    paragraph       = 1,
    href            = 2,
    ul              = 3,
    ol              = 4,
    li              = 5,
    em              = 6,
    strong          = 7,
    hr              = 8,
    br              = 9,
    image           = 10,
    quote           = 11,
    h1              = 12,
    h2              = 13,
    h3              = 14,
    h4              = 15,
    h5              = 16,
    h6              = 17,
    blockcode       = 18,
    code            = 19
};
// HTML prefix tag
const string frontTag[] = {
    "","<p>","","<ul>","<ol>","<li>","<em>","<strong>",
    "<hr color=#CCCCCC size=1 />","<br />",
    "","<blockquote>",
    "<h1 ","<h2 ","<h3 ","<h4 ","<h5 ","<h6 ", // cusp brackets reserved for properties of html tag
    "<pre><code>","<code>"
};
// HTML suffix tag
const string backTag[] = {
    "","</p>","","</ul>","</ol>","</li>","</em>","</strong>",
    "","","","</blockquote>",
    "</h1>","</h2>","</h3>","</h4>","</h5>","</h6>",
    "</code></pre>","</code>"
};
class MarkdownTransform{
private:
    string content, TOC;
public:
    MarkdownTransform(const std::string &filename);
    ~MarkdownTransform();

    std::string getTableOfContents() { return TOC; }
    std::string getContents() { return content; }
};
#endif
```

In our next experiment, we will finish all implementation.

```checker
- name: check if file exist
  script: |
    #!/bin/bash
    ls /home/labex/Code/mdtransform.hpp
  error: Oops! We find that you didn't create file "mdtransform.hpp" in /home/labex/Code!
  timeout: 3
```



## 5. References

1. [Markdown](http://daringfireball.net/projects/markdown/syntax)
