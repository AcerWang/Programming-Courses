---
show: step
version: 1.0
enable_checker: true
---
# File Packing and Compression

## 1. Introduction

#### 1.1 Content

In this lab, we will introduce some Linux compression / decompression tools, specifically the use of `zip`, `rar`, and `tar`.

#### 1.2 Key Points

- zip 
- tar 
- Combination of compression and decompression

## 2. Explanation

Before diving deep into the compression tools on Linux, it is necessary to introduce some commonly used file formats of compression package. The most common file formats on Windows are * .zip, * .rar, * .7z. On Linux, in addition to the above three formats, there are `*.gz`,` *.xz`, `*.bz2`,` *.tar`, `* .tar.gz`,` *.tar.xz`, `*.tar.bz2` .

| Extension  | Description                                                  |
| ---------- | ------------------------------------------------------------ |
| `*.zip`    | The files are packaged and compressed using zip programs     |
| `*.rar`    | The files are packaged and compressed using rar programs     |
| `*.7z`     | The files are packaged and compressed using 7z programs      |
| `*.tar`    | The uncompressed files are packaged using tar programs       |
| `*.gz`     | The compressed files are packaged using gzip programs        |
| `*.xz`     | The files are packaged and compressed using xz programs      |
| `*.bz2`    | The files are packaged and compressed using bzip2 programs   |
| `*.tar.gz` | The files are packaged using tar programs and compressed using gzip programs |
| `*.tar.xz` | The files are packaged using tar programs and compressed using xz programs |
| `*tar.bz2` | The files are packaged using tar programs and compressed using bzip2 programs |
| `*.tar.7z` | The files are packaged using tar programs and compressed using 7z programs |


## 3. zip and unzip
- Use `zip` to compress and package programs
- Use `unzip` to decompress a zipfile

###  3.1 Use `zip` to compress and package programs

- Use zip to package a folder:

```
$ cp -r /lib .
$ zip -r -q -o labex.zip /home/labex/lib
$ du -h labex.zip
$ file labex.zip
```

![image desc1](https://labex.io/upload/H/R/M/q96nMqStgv5z.jpeg)

The above command wraps the directory `/home/labex/lib` into a file. Now let's take a look at the size and type of the packaged file. In the first line of the command, the `-r` parameter indicates that the recursive package contains the entire contents of the subdirectories. The `-q` parameter represents a quiet mode meaning the message is not output to the screen. The  `-o` parameter indicates that the output file is required, followed by the package output file name. 

After packaging and compressing the directory, we will use `du` to view the size of the compressed file. 

- Set the compression level to 9 and 1 (9 maximum, 1 minimum):

```
$ zip -r -9 -q -o labex_9.zip /home/labex/lib -x ~/*.zip
$ zip -r -1 -q -o labex_1.zip /home/labex/lib -x ~/*.zip
```

We add a parameter to set the compression level - [1-9]. 1 means the fastest compression but bulky. 9 stands for the smallest size but takes the longest time. -x is to avoid the previous package-generated zip file being packaged into this current zipfile. **you can only use absolute path, otherwise it does not work**

We use `du` to view the default compression level, the minimum, and the highest compression level and also the size of uncompressed files:

```
$ du -h -d 0 *.zip ~ | sort
```
- h， --human-readable
- d， --max-depth（ Display an entry for all files and directories depth.

![image desc2](https://labex.io/upload/M/A/Q/XElUqBFEe8YM.jpeg)

You can see the default compression is the highest.

- Create an encrypted zip package

Using the -e parameter to create an encrypted file:

```
$ zip -r -e -o labex_encryption.zip /home/labex/lib
```

**warning:** For `zip` , there are some compatibility issues between Windows and Linux/UNIX, such as line break(a invisible character), which is CR + LF (Carriage-Return + Line-Feed) in windows. However, it is LF in Linux. If you open a text on Windows, which was edited in Linux, you can't see line breaks.

```
$ zip -r -l -o labex.zip /home/labex/lib
```

For the above problem, you need to add `-l` parameter to convert LF to CR + LF.
```checker
- name: check if content exist
  script: |
    #!/bin/bash
    grep -i 'zip' /home/labex/.zsh_history
  error: Oops, you didn't use "zip" cmd.
  timeout: 3
```
### 3.2 Using `unzip` to decompress a zipfile

Extract files in labex.zip to the current directory:

```
$ unzip labex.zip
```

Use quiet mode to extract the file to a specified directory:

```
$ unzip -q labex.zip -d ziptest
```

![image desc3](https://labex.io/upload/J/C/K/mPQwetLJUVgj.jpeg)

If you only intend to see the contents of the compressed package, you can use the `-l` parameter. The package will not be decompressed:

```
$ unzip -l labex.zip
```

Using the `-O` parameter, we can specify the encoding type:

```
unzip -O GBK ww.zip
```
```checker
- name: check if content exist
  script: |
    #!/bin/bash
    grep -i 'unzip' /home/labex/.zsh_history
  error: Oops, you didn't use "unzip" cmd.
  timeout: 3
```
## 4. rar

`rar` is a compressed file format on Windows. On Linux, you can use `rar` and `unrar`  to create and unzip rar files.

- Install `rar` and `unrar` :

```
$ sudo apt-get update
$ sudo apt-get install rar unrar
```

- Add files to archive:

```
$ rm *.zip
$ rar a labex.rar home/labex/lib
```

The above command use the `a` parameter to add a directory `~` to an archive.

**Warning：there is no `-` before parameters in the `rar` command**

- Remove a file from an archive:

```
$ rar d labex.rar .zshrc
```

- View an archive but not decompress it:

```
$ rar l labex.rar
```

- Use `unrar` to extract `rar` file

Unzip files to the current path：

```
$ unrar x labex.rar
```

Unzip files to a specified path:

```
$ mkdir tmp
$ unrar e labex.rar tmp/
```

**rar command has a lot of parameters. We are only going through some basic operations.**
```checker
- name: check if content exist
  script: |
    #!/bin/bash
    grep -iE 'rar' /home/labex/.zsh_history
  error: Oops, you didn't use "rar" cmd.
  timeout: 3
```
## 5. tar 

First of all, we start by learning some of the basic use of `tar`. 

- Create a tar archive without compression

```
$ tar -cf labex.tar home/labex/lib
```

![image desc4](https://labex.io/upload/K/N/Q/ekwnxz27QrlQ.jpeg)

The parameter `-c` means the creation of a tar archive. The parameter`-f` is used to specify a file name. Pay attention that the file name must be followed by the `-f` parameter. For example, you can **not **write the command like this: " tar-fc labex.tar". You can add the `-v` parameter to visually output the packaged files. 

- Unzip a file: using `-x` parameter to an existing directory or using `-C` parameter to a specified path:

```
$ mkdir tardir
$ tar -xf labex.tar -C tardir
```

![image desc](https://labex.io/upload/E/W/J/v4NrI6ORFNeq.png)

-  `-t`: View an archive but not decompress it:

```
$ tar -tf labex.tar
```

![image desc](https://labex.io/upload/S/A/J/g4emgDVzw3lt.png)

- You can use the `p` parameter to preserve the attributes of a file, and use the `-h`parameter to back up all links (symbolic links or soft links).

```
$ tar -cphf etc.tar /etc
```

For `tar`, it is easy to use different compression formats. Here we use `gzip`  to create `*. Tar.gz`  as an illustration.

- Adding the `-z` parameter, we can use gzip to compress files:

```
$ tar -czf labex.tar.gz home/labex/lib
```
![image desc5](https://labex.io/upload/N/F/Q/fNsWJEC1CEyG.jpeg)
- Unzip `*.tar.gz`：

```
$ tar -xzf labex.tar.gz
```

![image desc](https://labex.io/upload/F/C/O/F2DApcU75qT8.png)


We only need to change one parameter if we want to use a different compression tool:

| File format | Parameter |
| ----------- | --------- |
| `*.tar.gz`  | `-z`      |
| `*.tar.xz`  | `-J`      |
| `*.tar.bz2` | `-j`      |

```checker
- name: check if content exist
  script: |
    #!/bin/bash
    grep -i 'tar' /home/labex/.zsh_history
  error: Oops, you didn't use "tar" cmd.
  timeout: 3
```

## 6. Summary

Commonly used commands：

### 6.1 zip：

- zip something 
- unzip something
- Specify a path：`-d` 

### 6.2 tar：

- zip：tar -zcvf something.tar something
- unzip：tar -zxvf something.tar
- Specify a path：`-C` 


### 6.3 Time for fun

Here's an interesting program which can simulate the shape of flame:

```
$ sudo apt-get install libaa-bin 
$ aafire
```

## 7. Homework

Create a file named `test`, then use `zip` and `tar` to package and compress it respectively. Last step, you need to extract the archive to `/home/labex`.